<!doctype html>
<html>

<head>
    <title>LUDO</title>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <link href="//fonts.googleapis.com/css?family=Monoton" rel="stylesheet" media>
    <link href="//fonts.googleapis.com/css?family=Montserrat" rel="stylesheet" media>
    <link href="//fonts.googleapis.com/css?family=Josefin+Sans" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Quicksand" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Cousine" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/3.4.2/css/swiper.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/3.4.2/css/swiper.min.css">
    <link href="app.css" rel="stylesheet" />
</head>

<body>
    <div id="login">
      <div class="video-background">
        <div class="video-foreground">
          <iframe id="backgroundvid" src="https://www.youtube.com/embed/YkfULbJ9GVU?loop=1&controls=0&showinfo=0&rel=0&autoplay=1&mute=1" frameborder="0" allowfullscreen></iframe>
        </div>  
      </div>
        <h1>LUDO</h1>
        <a href="/login"><img src="img/spotifyicon.png" class="" width="100" /></a>
          <div class="logintext">
            <img class="invert flip" src="https://maxcdn.icons8.com/Share/icon/Arrows//down41600.png" width='10' height='10' />
            <h2>LOGIN</h2>
          </div>     
    </div>
    <div id="loggedin">
        <div class="grid">
            <div class="left">
              <div class="profTemp">
                <img src="https://s-media-cache-ak0.pinimg.com/736x/24/28/10/242810087197ad884c0d895c2953a740.jpg" width="40" height="40" />
                <span>Frank Ocean</span>
              </div>
              
              <div class="profTemp">
                <img src="https://i1.sndcdn.com/avatars-000275328494-x0ummz-t500x500.jpg" width="40" height="40" />
                <span>Connie Constance</span>
              </div>
              
              
              <div class="profTemp">
                <img src="https://www.tinymixtapes.com/sites/default/files/imagecache/Article_Width/1412/artworks-000097529084-s9nava-t500x500.jpg" width="40" height="40" />
                <span>NAO</span>
              </div>
              <div class="profTemp">
                <img src="https://i1.sndcdn.com/avatars-000282552589-ewmqcs-t500x500.jpg" width="40" height="40" />
                <span>Brent Faiyaz</span>
              </div>
              
              <div class="profTemp">
                <img src="https://cdn-s3.allmusic.com/release-covers/500/0004/624/0004624822.jpg" width="40" height="40" />
                <span>Solange</span>
              </div>
              
              
              <div class="profTemp">
                <img src="https://brightsidelive.com/wp-content/uploads/earl-sweatshirt.jpg" width="40" height="40" />
                <span>Earl Sweatshirt</span>
              </div>
              <div class="profTemp">
                <img src="https://68.media.tumblr.com/5e687ecaa7e8bae1e20e9c80e51185ad/tumblr_o5tp3ucSMB1rtauc1o1_500.jpg" width="40" height="40" />
                <span>Skepta</span>
              </div>
              <div class="profTemp">
                <img src="https://s3.amazonaws.com/bucketeer-373b822b-859a-491c-934d-506d803eb341/artist/vfd9Q9nlJ8adbEtVW9o1nezrbx5Km3Nip3w978xR" width="40" height="40" />
                <span>Ray Blk</span>
              </div>
              <div class="profTemp">
                <img src="https://www.tinymixtapes.com/sites/default/files/imagecache/Article_Width/1412/artworks-000097529084-s9nava-t500x500.jpg" width="40" height="40" />
                <span>NAO</span>
              </div> 
              <div class="profTemp">
                <img src="https://i1.sndcdn.com/artworks-000128440509-uqhyuv-t500x500.jpg" width="40" height="40" />
                <span>Rex Orange County</span>
              </div>
              <div class="profTemp">
                <img src="https://s-media-cache-ak0.pinimg.com/originals/09/b7/27/09b727b145efb31556e50fb5ecbd0774.jpg" width="40" height="40" />
                <span>King Krule</span>
              </div>
              <div class="profTemp">
                <img src="https://i1.sndcdn.com/avatars-000210207184-xy9abz-t500x500.jpg" width="40" height="40" />
                <span>Jamie Isaac</span>
              </div>             
              <div class="profTemp">
                <img src="https://68.media.tumblr.com/3e2529b6651bc7c91683192af22339a8/tumblr_oo0tyzV1Fl1tc0atto1_500.jpg" width="40" height="40" />
                <span>Adwoah Aboah</span>
              </div>
              
              <div class="profTemp">
                <img src="https://s3.amazonaws.com/beatstarsdata/b.user.data/w/westweekend-152110/gfx/cover-artwork/238117_med_.jpg" width="40" height="40" />
                <span>Tyler</span>
              </div>
              <div class="profTemp">
                <img src="https://dontfckabout.files.wordpress.com/2016/10/yeah-yeah.jpg?w=730" width="40" height="40" />
                <span>Jesse James Solomon</span>
              </div>
              <div class="profTemp">
                <img src="https://i1.sndcdn.com/artworks-000166667136-5heltz-t500x500.jpg" width="40" height="40" />
                <span>Snoochie Shy</span>
              </div>
              <div class="profTemp">
                <img src="https://thumbnailer.mixcloud.com/unsafe/300x300/extaudio/5/3/e/9/0648-ec8e-4d76-923e-1b837ea94eb2.jpg" width="40" height="40" />
                <span>Sofie Fatouretchi</span>
              </div>
             
              <div class="profTemp">
                <img src="https://68.media.tumblr.com/9bd38039b2ed72c3f8f79b5841c0248c/tumblr_oion4yG1a21rb7lvjo1_500.jpg" width="40" height="40" />
                <span>Steve Lacy</span>
              </div>
              <div class="profTemp">
                <img src="https://68.media.tumblr.com/f281802a37d7ada6b610ad31a862543e/tumblr_nstvm65CZ81r2mlhzo1_500.png" width="40" height="40" />
                <span>Lisa Bonet</span>
              </div>
              
            </div>
            <div class="center">
                <h1>LUDO</h1>
               
                  <div class="swiper-container">
                    <div class="swiper-wrapper">
                    </div>
                    <img class="swiper-button-prev swiper-button-white" src="https://cdn0.iconfinder.com/data/icons/slim-square-icons-basics/100/basics-05-128.png" />
                    <img class="swiper-button-next swiper-button-white" src="https://cdn0.iconfinder.com/data/icons/slim-square-icons-basics/100/basics-05-128.png" />
                  </div> 

                <div class="player">
                  <input type="image" class="invert" id="previous" src="img/rewind.png" width="25" height="25" />
                  <input type="image" class="invert" id="play-pause" src="https://cdn3.iconfinder.com/data/icons/google-material-design-icons/48/ic_play_arrow_48px-512.png"  width="25" height="25" />
                  <input type="image" class="invert rotate" id="fast-forward" src="img/rewind.png" class="flip" width="25" height="25" />
                </div> 
                
                     
            </div>
            <div class="right">
              <div class="top">
                <div class="live">
                  <span id="livespan">LIVE</span>
                  <div class="onoffswitch">
                    <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="toggle">
                    <label class="onoffswitch-label" for="toggle">
                      <span class="onoffswitch-inner"></span>
                      <span class="onoffswitch-switch"></span>
                    </label>
                  </div> 
                </div> 
              </div>
              <div class ="bottom">
                <div class ="header">
                <span>LYRICS</span>
                </div>
                <div class="lyrics">
                </div>
              </div>      
            </div>
            
            
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/3.4.2/js/swiper.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/3.4.2/js/swiper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/3.4.2/js/swiper.jquery.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/3.4.2/js/swiper.jquery.min.js"></script>
    <script type="text/javascript" src="https://tracking.musixmatch.com/t1.0/AMa6hJCIEzn1v8RuOP"></script>
    
    
    <script>
      var slidesPerView = 3;
      var swiper = new Swiper('.swiper-container', {
        pagination: '.swiper-pagination',
        slidesPerView: slidesPerView,
        keyboardControl: true,
        centeredSlides: true,
        paginationClickable: true,
        spaceBetween: 100,
        nextButton: '.swiper-button-next',
        prevButton: '.swiper-button-prev',
        breakpoints: {
          768: {
            slidesPerView: 1,
            spaceBetween: 10,
          }
        },
      });


    </script>
    <script>
    (function() {
        /**
         * fuck off looking at my code you snake
         * @return Object
         */
        function getHashParams() 
        {
            var hashParams = {};
            var e, r = /([^&;=]+)=?([^&;]*)/g,
                q = window.location.hash.substring(1);
            while (e = r.exec(q)) {
                hashParams[e[1]] = decodeURIComponent(e[2]);
            }
            return hashParams;
        }



        var params = getHashParams();

        var access_token = params.access_token,
            refresh_token = params.refresh_token,
            error = params.error;

        function refreshToken()
        {
          $.ajax({
            url: '/refresh_token',
            data: {
              'refresh_token': refresh_token
            }
          }).done(function(data) {
                access_token = data.access_token;
            });

          setTimeout(refreshToken, 1000000);
        }

        if (error)
        {
            alert('There was an error during the authentication');
        } 
        else 
        {
            if (access_token) 
            {

                var imgsrc;
                var currentUserName;
                var profiler;
                var songName;
                var artistName;
                var albumName;
                var progress;
                var songLength;
                var songURL;
                var isPlaying;
                var uri;
                var deviceID;
                var playbackArray = [];
                var i = 0;


                var jsonPushData = {
                    userName: currentUserName,
                    albumArt: imgsrc,
                    songName: songName,
                    artistName: artistName,
                    albumName: albumName,
                    songProgress: progress,
                    songLength: songLength,
                    songURL: songURL,
                    isPlaying: isPlaying
                };


                displayUserInfo();
                getCurrentSong();
                //refreshToken();


                function getCurrentSong() 
                {

                    $.ajax({
                        url: 'https://api.spotify.com/v1/me/player',
                        headers: {
                            'Authorization': 'Bearer ' + access_token
                        },
                        success: function(response) {

                          imgsrc = response.item.album.images[0].url;
                          songName = response.item.name;
                          artistName = response.item.artists[0].name;
                          albumName = response.item.album.name;
                          progress = response.progress_ms;
                          songLength = response.timestamp;
                          isPlaying = response.is_playing;
                          uri = response.item.uri;
                          deviceID = response.device.id;
                          trackID = response.item.id;

                          var user = returnUser();

                          jsonPushData = {
                            userName: user,
                            albumArt: imgsrc,
                            songName: songName,
                            artistName: artistName,
                            albumName: albumName,
                            songLength: songLength,
                            songURL: songURL,
                            isPlaying: isPlaying,
                            uri: uri,
                            deviceID: deviceID,
                            trackID: trackID,
                            songProgress: progress
                          };

                          updateJSON(jsonPushData);   


                            if(playbackArray.length == 0) 
                            {
                              playbackArray[i] = jsonPushData;
                              $('.swiper-wrapper').prepend($('<div/>', {class: 'swiper-slide swiper-slide-active'}).append(
                                $('<div/>', {class: 'getCurrentTrack'}).append(
                                  $('<div/>', {class: 'trackTemplate', id: playbackArray[0].trackID}).append(
                                    $('<img/>', {src: jsonPushData.albumArt}),
                                    $('<figcaption/>', {class: 'songName', text: playbackArray[0].songName}),
                                    $('<figcaption/>', {class: 'artistName', text: playbackArray[0].artistName}),
                                    $('<figcaption/>', {class: 'albumName', text: playbackArray[0].albumName}),
                                    $('<img/>', {class: 'invert position', src: 'https://indianassist.mx/img/downArrow.png', 
                                      alt: playbackArray[0].trackID, width: 23, height: 23})))));

                              /*Tumblr Call
                              $.ajax({   
                                url: 'https://api.tumblr.com/v2/tagged',
                                method: "GET",
                                contentType: "application/json",
                                dataType: 'jsonp',
                                data: {tag: artistName, limit: '200', api_key: 'NdKsnACtQWQ3Ffn5Wx81lCZR16UtKEr8ewXRtfvKFnbsjLqUW5', "format": "jsonp"},
                                success: function(response) 
                                {
                                  for(var i = 0; i < response.response.length; i++)
                                  {
                                    if(response.response[i].type === "photo")
                                    {
                                       $('.footprintContainer').prepend($('<img/>', {class: '.footprintContainer img', src: response.response[i].photos[0].original_size.url}));
                                      console.log(response.response[i].photos[0].original_size.url);
                                    }
                                  }
                                  console.log(response);
                                }
                              });
                              */
                                swiper.updateSlidesSize();
                                getLyrics(playbackArray);

                                if(user) 
                                {
                                  updateJSON(jsonPushData);
                                }
                                i = i + 1;
                                console.log(playbackArray);
                                getJSON();
                            } 

                            else if((playbackArray[0].isPlaying != isPlaying) && (playbackArray[0].songName == songName))
                            {
                              playbackArray[0] = jsonPushData;
                              if(user)
                              {
                                updateJSON(jsonPushData);
                              }                                 
                            }

                            else if ((playbackArray[0].songName != songName)) 
                            {
                              var startIndex = 0;
                              var numElemtoRemove = 0;
                              playbackArray.splice(startIndex, numElemtoRemove, jsonPushData);
                              i = i + 1;

                              $('.swiper-wrapper').prepend($('<div/>', {class: 'swiper-slide'}).append(
                                $('<div/>', {class: 'getCurrentTrack'}).append(
                                  $('<div/>', {class: 'trackTemplate', id: playbackArray[0].trackID}).append(
                                    $('<img/>', {src: jsonPushData.albumArt}),
                                    $('<figcaption/>', {class: 'songName', text: playbackArray[0].songName}),
                                    $('<figcaption/>', {class: 'artistName', text: playbackArray[0].artistName}),
                                    $('<figcaption/>', {class: 'albumName', text: playbackArray[0].albumName}),
                                    $('<img/>', {class: 'invert position', src: 'https://indianassist.mx/img/downArrow.png', width: 23, height: 23})))));

                              /* Tumblr call
                              $.ajax({   
                                url: 'https://api.tumblr.com/v2/tagged',
                                method: "GET",
                                contentType: "application/json",
                                dataType: 'jsonp',
                                data: {tag: artistName, limit: 10, api_key: 'NdKsnACtQWQ3Ffn5Wx81lCZR16UtKEr8ewXRtfvKFnbsjLqUW5', "format": "jsonp"},
                                success: function(response) 
                                {
                                  for(var i = 0; i < response.response.length; i++)
                                  {
                                    if(response.response[i].type === "photo")
                                    {
                                       $('.footprintContainer').prepend($('<img/>', {class: '.footprintContainer img', src: response.response[i].photos[0].original_size.url}));
                                      console.log(response.response[i].photos[0].original_size.url);
                                    }
                                  }
                                  console.log(response);
                                }
                              });
                              */
                              
                              getLyrics(playbackArray);

                              swiper.updateSlidesSize()

                                if(user) 
                                {
                                  updateJSON(jsonPushData);
                                }
                                getJSON();
                                console.log(playbackArray[0].songName);
                                //console.log(playbackArray);
                            }

                            $('#login').hide();
                            $('#loggedin').show();
                        }
                    });
                    setTimeout(getCurrentSong, 2000);
                }

                function getLyrics(array)
                {
                  var musixmatch = "f95b0e13b5e6b3336b48703201a8633e";
                  var song = array[0].songName;
                  var artist = array[0].artistName;
                  var lyricsID;
                  var songLyrics;

                  $.ajax({
                    type: "GET",
                    data: {
                      "apikey": musixmatch,
                      "q_track": song,
                      "q_artist": artist,
                      "format": "jsonp",  
                    },
                    url: "https://api.musixmatch.com/ws/1.1/matcher.lyrics.get",
                    dataType: "jsonp",
                    contentType: 'application/json',
                    success: function(response)
                    {
                      if(!response.message.body.lyrics)
                      {
                        $(document.getElementsByClassName('lyricsSet')).remove();
                        $('.lyrics').append($('<pre/>', {class: 'lyricsSet', text: "\n\n\n\n\n\n" + "         lyrics unavailable for this song"}));
                      }

                      else
                      {

                        songLyrics = response.message.body.lyrics.lyrics_body;
                        songLyrics = songLyrics.slice(0, -74);
                        $(document.getElementsByClassName('lyricsSet')).remove();
                        $('.lyrics').append($('<pre/>', {class: 'lyricsSet', text: "\n" + "\n" + songLyrics + "\nfor cold hard cash you can get the rest on musixmatch.com "}));
                      }
                     
                      
                   
                      console.log(songLyrics);
                    },
                    
                  });

                }

                function getProgress()
                {
                  return songProgress;
                }

                function displayUserInfo() 
                {
                  refreshToken();
                  $.ajax({
                    url: 'https://api.spotify.com/v1/me',
                    headers: {
                         'Authorization': 'Bearer ' + access_token
                    },
                    success: function(response) {
                      profiler = response.images[0].url;
                      currentUserName = response.display_name;
                      if (!currentUserName) 
                      {
                        currentUserName = response.id;
                      }
                            
                    }
                  });
                }

                function getJSON() 
                {
                  var returnVal;
                  $.ajax({
                    url: '/getJSON',
                    dataType: 'json',
                    success: function(response) {
                      returnVal = response;
                    }
                  });

                 // return returnVal;
                }

                function updateJSON(jsonData)
                {
                  $.ajax({
                    data: JSON.stringify(jsonData),
                    url: '/updateJSON',
                    method: "POST",
                    contentType: "application/json",
                    dataType: 'json',
                    success: function(response) 
                    {
                    }
                  });
                }


                function returnUser() {
                  return currentUserName;
                }

                function returnProfiler() {
                  return profiler;
                }

                document.getElementById('toggle').addEventListener('click', function() 
                {
                    var user = returnUser();
                    var profiler = returnProfiler();
    
                    var live = this.checked;
                    var userNameData = {
                        userNameData: user,
                        active: live,
                        profiler: profiler
                    };

                    $.ajax({
                        data: JSON.stringify(userNameData),
                        url: '/updateUserStatus',
                        method: 'POST',
                        contentType: 'application/json',
                        dataType: 'html',
                        success: function(response) {
              
                        }
                    });
                });

                displayLive()

                function displayLive()
                {
                  var previous = null;
                  var current = null;
                  setInterval(function()
                  {
                    $.ajax({
                      url: '/showLive',
                      dataType: 'json',
                      contentType: 'application/json',
                      success: function(response) 
                      {
                        current = JSON.stringify(response);
                        if(previous !== current)
                        {
                          var obj = JSON.parse(response);
                          for(var i = 0; i < obj.active.length; i++)
                          {
                            if($(document.getElementById(obj.active[i].userNameData)).length == 0)
                            {
                              if((obj.active[i].userNameData !== undefined) && (obj.active[i].active === true) && (obj.active[i].userNameData != returnUser()))
                              {
                                $('.left').prepend($('<div/>', {class: 'profTemp', id: obj.active[i].userNameData}).append(
                                  $('<img/>', {src: obj.active[i].profiler, width: 40, height: 40}),
                                  $('<span/>', {text: " " + obj.active[i].userNameData}))); 
                              }  
                              
                            }
                            else if(obj.active[i].active === false)
                            {
                              $(document.getElementById(obj.active[i].userNameData)).remove();
                              clearInterval(pollUser);
                            }
                          }
                        }
                      }
                    }); 
                    previous = current; 
                  }, 2000);   
                }

                function playSong(uri, device)
                {
                  $.ajax({
                    url: 'https://api.spotify.com/v1/me/player/play',
                    contentType: 'application/json',
                    type: 'PUT',
                    dataType: 'json',
                    headers: {
                      'Authorization': 'Bearer ' + access_token
                    },
                    data: JSON.stringify({"uris":[uri], "device_id":device, "offset": { "uri":uri} }),
                    success: function(response) {
                    }
                  });
                }

                function seekTo(songProgress, device)
                {
                  $.ajax({
                    url: 'https://api.spotify.com/v1/me/player/seek',
                    contentType: 'application/json',
                    type: 'PUT',
                    dataType: 'json',
                    headers: {
                      'Authorization': 'Bearer ' + access_token
                    },
                    data: JSON.stringify({'position_ms':songProgress, "device_id":device}),
                    success: function(response) {
                    }
                  });
                }

                function pauseSong(device)
                {
                  $.ajax({
                    url: 'https://api.spotify.com/v1/me/player/pause',
                    contentType: 'application/json',
                    type: 'PUT',
                    dataType: 'json',
                    headers: {
                    'Authorization': 'Bearer ' + access_token
                    },
                    data: JSON.stringify({"device_id":device}),
                    success: function(response) {    
                    }
                  });
                }

                function checkActive(user)
                {
                  var active;
                   $.ajax({
                      data: JSON.stringify({"user":user}),
                      url: '/checkActive',
                      method: 'GET',
                      contentType: 'application/json',
                      dataType: 'json',
                      success: function(response){
                        active = response.active;
                      }
                    });

                   return active;
                   console.log(active);
                }

                var pollUser;

                $(document).on("click",".profTemp", function()
                {    
                    
                  if(!$(this).hasClass('selected'))
                  {

                    var selectedUser;
                    var previous = null;
                    var current = null;
                    var assigned = false;
                    var currentSong;
                    var previousSong;
                    var previousUser = null;

                    selectedUser = $(this).children('span').text();
                    selectedUser = selectedUser.trim();

                    $('.profTemp').removeClass('selected');
                    clearInterval(pollUser);
                   
                    $(this).toggleClass('selected');

                    pollUser = setInterval(function()
                    {



                      $.ajax({
                        url: '/getJSON',
                        dataType: 'json',
                        success: function(response) {
                          obj = JSON.parse(response);
                          var changeTo;
                          var deviceID;
                          var playing;
                          var progress;

                          
                          if(checkActive(selectedUser) == false)
                          {
                            pauseSong(deviceID);
                            selectedUser == null;
                          }
                      
                            for(var i = 0; i < obj.clients.length; i++)
                            {
                              if(selectedUser == obj.clients[i].userName) 
                              {
                                
                                current = JSON.stringify(obj.clients[i]);
                                changeTo = obj.clients[i].uri;
                                deviceID = obj.clients[i].deviceID
                                playing = obj.clients[i].isPlaying;
                                currentSong = obj.clients[i].songName;                                     
                              }
                            }

                            for(var i = 0; i < obj.songProgress.length; i++)
                            {
                              if(selectedUser == obj.songProgress[i].userName)
                              {
                                progress = obj.songProgress[i].songProgress;
                              }                              
                            }  

                            if(playing == false)
                            {
                              pauseSong(deviceID);
                            }
        
                            else if(playing == true)
                            {
                              if(previous !== current && (currentSong !== previousSong))
                              {

                                playSong(changeTo, deviceID);
                                
                                if(previousUser !== selectedUser)
                                {                                     
                                  var seekPos = { position_ms: progress};

                                  $.ajax({
                                    url: 'https://api.spotify.com/v1/me/player/seek' + '?' + $.param(seekPos),
                                    contentType: 'application/x-www-form-urlencoded',
                                    type: 'PUT',
                                    headers: {
                                      'Authorization': 'Bearer ' + access_token
                                    },
                                    data: {'device_id':deviceID},
                                    success: function(response) {
                                    }
                                  });                                  
                                  previousUser = selectedUser;
                                  
                                }

                                else if(previousUser === selectedUser)
                                {
                                  playSong(changeTo, deviceID);
                                }         
                                
                              } 

                              else if(previous !== current && (currentSong == previousSong))  
                              {  

                                $.ajax({
                                  url: 'https://api.spotify.com/v1/me/player/play',
                                  contentType: 'application/json',
                                  type: 'PUT',
                                  dataType: 'json',
                                  headers: {
                                    'Authorization': 'Bearer ' + access_token
                                  },
                                  data: "",
                                  success: function(response) {
                                  }
                                });
                              }
                            }                   
                          }
                        });
                      previous = current;
                      previousSong = currentSong;                      
                    }, 2000);
                  }

                  else if($(this).hasClass('selected'))
                  {
                    $(this).toggleClass('selected');
                    pauseSong(deviceID);

                    
                    clearInterval(pollUser);
                  }    
                }); 

                

                $("selected").on("click", function(event)
                {
                    event.stopPropagation();
                });

                $(document).on("click",".position", function(){ 
                  var selectedSong;
                  selectedSong = $(this).parent('div').attr('id'); 

                   $.ajax({
                      url: 'https://api.spotify.com/v1/me/tracks',
                      contentType: 'application/json',
                      type: 'PUT',
                      dataType: 'json',
                      headers: {
                        'Authorization': 'Bearer ' + access_token
                      },
                      data: JSON.stringify({"ids":[selectedSong]}),
                      success: function(response) {
                      }
                    });
                }); 
                
                document.getElementById('previous').addEventListener('click', function() 
                {
                  $(document.getElementsByClassName('selected')).removeClass('selected')
                  clearInterval(pollUser);
                  $.ajax({
                    url: 'https://api.spotify.com/v1/me/player/previous',
                    contentType: 'application/json',
                    type: 'POST',
                    dataType: 'json',
                    headers: {
                      'Authorization': 'Bearer ' + access_token
                    },
                    data: "",
                    success: function(response) {
                    }
                  });
                  ;
                  
                });

                document.getElementById('fast-forward').addEventListener('click', function() 
                {
                  $(document.getElementsByClassName('selected')).removeClass('selected')
                  clearInterval(pollUser);
                  $.ajax({
                    url: 'https://api.spotify.com/v1/me/player/next',
                    contentType: 'application/json',
                    type: 'POST',
                    dataType: 'json',
                    headers: {
                      'Authorization': 'Bearer ' + access_token
                    },
                    data: "",
                    success: function(response) {
                    }
                  });

                   ;
                   
                });

                 document.getElementById('play-pause').addEventListener('click', function() 
                {
                  if($(this).hasClass('paused'))
                  {
                    $.ajax({
                      url: 'https://api.spotify.com/v1/me/player/play',
                      contentType: 'application/json',
                      type: 'PUT',
                      dataType: 'json',
                      headers: {
                        'Authorization': 'Bearer ' + access_token
                      },
                      data: "",
                      success: function(response) {
                      }
                    });

                    $(this).toggleClass('paused');
                    $('#play-pause').attr('src', 'https://cdn0.iconfinder.com/data/icons/octicons/1024/playback-pause-24.png');
                  }

                  else
                  {
                    var deviceID;
                    $.ajax({
                      url: '/getJSON',
                      dataType: 'json',
                      success: function(response) 
                      {
                        obj = JSON.parse(response);  
                        var user = returnUser()
                        for(var i = 0; i < obj.clients.length; i++)
                        {
                          if(user == obj.clients[i].userName) 
                          {
                            deviceID = obj.clients[i].deviceID;                                    
                          } 
                        } 
                      }          
                    });

                    pauseSong(deviceID);
                    $(this).toggleClass('paused');
                   
                    $('#play-pause').attr('src', 'https://cdn3.iconfinder.com/data/icons/google-material-design-icons/48/ic_play_arrow_48px-512.png');

                  }
                  
                });

                 window.addEventListener("beforeunload", function()
                 {
                  var user = returnUser();
                  if(user)
                  {
                    var jsonData = {
                      userNameData: user,
                      active: false,
                      profiler: profiler
                    }

                    $.ajax({
                      data: JSON.stringify(jsonData),
                      url: '/updateUserStatus',
                      method: 'POST',
                      contentType: 'application/json',
                      dataType: 'html',
                      success: function(response) {
              
                        }
                    });
                  }
                });

                //}

            } else {
                // render initial screen
                $('#login').show();
                $('#loggedin').hide();
            }
        }
    })();
    </script>
     
</body>

</html>
